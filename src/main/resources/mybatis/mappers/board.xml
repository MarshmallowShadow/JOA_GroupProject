<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

	<!-- 리스트 불러오기 + 페이징 -->
	<select id="board" parameterType="String" resultType="map">
		<![CDATA[
			select ort.rn
		           , ort.boardNo
		           , ort.boardCategory
		           , ort.title
		           , ort.id
		           , ort.viewCount
		           , ort.regDate
		           , ort.userNo
		           , ort.count
			from (select rownum rn
	                     , ot.boardNo
	                     , ot.boardCategory
	                     , ot.title
	                     , ot.id
	                     , ot.viewCount
	                     , ot.regDate
	                     , ot.userNo
	                     , ot.count
		          from (select b.board_no boardNo
		          			   , b.board_category boardCategory
	                           , b.title
	                           , u.id
	                           , b.view_count viewCount
	                           , to_char(b.reg_date,'YYYY-MM-DD') regDate
	                           , b.user_no userNo
	                           , cn.count
	                  from users u, board b left outer join (select count(*) count
					                  							    , board_no
					                  						 from board_comment
					                  						 group by board_no) cn
					  on cn.board_no = b.board_no
	                  where u.user_no = b.user_no
	                  and title like #{keyword}
				      and board_category like #{boardCategory}
	                  order by b.board_no desc)ot
	                  )ort
			where rn>=#{startRnum}
			and rn<=#{endRnum}
		]]>
	</select>
	
	
	<!-- 전체 글갯수 구하기 -->
	<select id="selectTotalCnt" resultType="int">
		<![CDATA[
			select count(*) count
			from board b, users u
			where b.user_no = u.user_no
		]]>
	</select>
	
	
	<!-- 게시판 글쓰기(둘 다 null) -->
	<insert id="insertBoth" parameterType="BoardVo">
		<selectKey keyProperty="boardNo" resultType="int" order="BEFORE">
			select SEQ_BOARD_NO.nextval from dual
		</selectKey>
		<![CDATA[
			insert into board (board_no, user_no, board_category, title, content, reg_date, view_count)
			values(#{boardNo}, #{userNo}, #{boardCategory}, #{title}, #{content}, sysdate, 0)
		]]>
	</insert>
	<!-- 게시판 글쓰기(코스 null) -->
	<insert id="insertCourse" parameterType="BoardVo">
		<selectKey keyProperty="boardNo" resultType="int" order="BEFORE">
			select SEQ_BOARD_NO.nextval from dual
		</selectKey>
		<![CDATA[
			insert into board (board_no, user_no, event_no, board_category, title, content, reg_date, view_count)
			values(#{boardNo}, #{userNo}, #{eventNo}, #{boardCategory}, #{title}, #{content}, sysdate, 0)
		]]>
	</insert>
	<!-- 게시판 글쓰기(함께하기 null) -->
	<insert id="insertTogether" parameterType="BoardVo">
		<selectKey keyProperty="boardNo" resultType="int" order="BEFORE">
			select SEQ_BOARD_NO.nextval from dual
		</selectKey>
		<![CDATA[
			insert into board (board_no, user_no, course_no, board_category, title, content, reg_date, view_count)
			values(#{boardNo}, #{userNo}, #{courseNo}, #{boardCategory}, #{title}, #{content}, sysdate, 0)
		]]>
	</insert>
	<!-- 게시판 글쓰기(전체) -->
	<insert id="insertAll" parameterType="BoardVo">
		<selectKey keyProperty="boardNo" resultType="int" order="BEFORE">
			select SEQ_BOARD_NO.nextval from dual
		</selectKey>
		<![CDATA[
			insert into board (board_no, user_no, course_no, event_no, board_category, title, content, reg_date, view_count)
			values(#{boardNo}, #{userNo}, #{courseNo}, #{eventNo}, #{boardCategory}, #{title}, #{content}, sysdate, 0)
		]]>
	</insert>
	
	
	<!-- 게시판 내용 읽기 -->
	<select id="read" parameterType="int" resultType="map">
		<![CDATA[
			select b.board_no boardNo
			        , b.board_category boardCategory
                    , b.title
                    , u.id
                    , b.content
                    , b.view_count viewCount
                    , to_char(b.reg_date,'YYYY-MM-DD') regDate
                    , b.user_no userNo
			from board b, users u
	        where u.user_no = b.user_no
			and b.board_no = #{no}
		]]>
	</select>
	
	
	<!-- 게시판 조회수 -->
	<update id="boardHit" parameterType="int">
		<![CDATA[
			update board
			set view_count = view_count + 1
			where board_no = #{no}
		]]>
	</update>

</mapper>